---
layout: section
---

# A look in the direction of ADIOS

---
level: 2
---

# ADIOS 

<div grid="~ cols-2 gap-4" class="mt-4">
 <div class="col-span-1">

- `AD`aptable `I`nput `O`utput `S`ystem: [summary]
    - Extreme scale I/O: `YES!`
    - A file-only I/O library: `NO!`

- ADIOS [Engines]:
    - BP5
    - Sustainable Staging Transport (SST)
 </div>
 <div class="col-span-1">
 <br> <br>
 <img src="/img/06_adios.png" class="ml-2 border=2px"/>

 Figure taken from `The Adaptable IO System (ADIOS)`, book chapter in [In Situ Visualization for Computational Science]
 </div>
</div>

[summary]: https://adios2.readthedocs.io/en/latest/introduction/introduction.html#what-adios2-is-and-isn-t
[Engines]: https://adios2.readthedocs.io/en/latest/engines/engines.html
[In Situ Visualization for Computational Science]: https://link.springer.com/book/10.1007/978-3-030-81627-8

---
level: 2
---

# ADIOS I/O Abstraction
<br>

- "Variables" (n-dimensional distributed arrays of a particular type)
- "Attributes" (labels associated with individual variables or the entire
output data set).
- "Steps" specify when the data is available for output.

<Admonition type="info" title="" >

- We are missing the descriptions of mesh types... We\'ll follow up on that...
- There is nothing in the ADIOS interface that prescribes how to handle the data
</Admonition>

---
level: 2
---

# ADIOS SST Engine
<br>

- SST allows direct connection of data producers and consumers via the ADIOS2
write/read API

- the SST buffering policy can be configured at run-time

- SST readers and writers `do not necessarily move in lockstep`, but depending
upon the queue length parameters and queueing policies specified, differing
reader and writer speeds may cause `one or the other side to wait for data to be
produced or consumed`, or `data may be dropped` if allowed by the queueing
policy

- SST supports full <span style="color: #ff0000;">MxN</span> data distribution

---
level: 2
---

# Post-hoc Visualization with ADIOS2 and Fides

  <div class="w-180">
        <img src="/img/06_adios_bp4.png" class="ml-20 border=1px"/>
  </div>

---
level: 2
---

# Fides: an ADIOS Schema
<br>

- Schemas provide the ability to annotate the semantics of the array-based
layout of data in ADIOS.
- They provide the meaning of each data array, and the relationship between
groups of arrays:
    - Coordinates arrays
    - Connectivity arrays
- [Fides] is a library that uses a JSON data model to map ADIOS2 data arrays to
VTK-m datasets.
- Simulations already using ADIOS2 do not need to make any changes to the way
their data is written/streamed by ADIOS.

[Fides]: https://fides.readthedocs.io/en/latest/

---
level: 2
---

# Fides: an ADIOS Schema

- An ADIOS description of Variable and Attributes is augmented with attributes
describing the [supported data model]

[supported data model]: https://fides.readthedocs.io/en/latest/components/components.html#data-model-generation

<div class="w-160 ml-30">
  <img src="/img/06_adios_datamodel.png" />
</div>

---
level: 2
---

# In-transit Visualization with ADIOS2

  <div class="w-180">
        <img src="/img/06_adios_sst.png" class="ml-20 border=1px"/>
  </div>

---
level: 2
---

# VTK-m/Viskores facts
<br>

- Advances in processor technology include ever greater numbers of cores,
hyperthreading, accelerators with integrated blocks of cores, and special
vectorized instructions, all of which require more software parallelism to
achieve peak performance
- [VTK-m] is a visualization toolkit for multi-/many-core architectures with
support for finer threading typical in HPC today
- VTK-m, has now been rebranded as [Viskores]


<br>

- Viskores has its own self-contained lightweight rendering package
- Rendering done by Viskores’s rendering classes is performed offscreen
- Viskores's data model differs from the traditional VTK data model!

[VTK-m]: https://m.vtk.org/
[Viskores]: https://viskores.readthedocs.io/en/v1.1.0

---
level: 2
---

## Instrument a mini Heat Diffusion example with ADIOS. Act III

- Revisit our [Heat Diffusion] example
- Inspect adios2.xml

[Heat Diffusion]: https://github.com/jfavre/InSitu-Vis-Tutorial/tree/main/Examples/HeatDiffusion/Python

```
uenv start paraview/6.0.1:v1 --view=default
spack load adios2
```
- see instructions on how to build FIDES
- compile the SST data consumer
- inspect intransit.sh

---
level: 2
---

# ADIOS Plugin
<br>

- ADIOS has the ability for users to load their own engines and operators
through plugins
- As of v2.9, ADIOS has a ParaView `plugin`
    - Uses Catalyst and the Fides JSON description
    - Uses the `inline` engine
    - The Inline engine provides in-process communication between writers and
    readers, avoiding the copy of data buffers.
    - This engine is focused on the N → N case
    - Data are not copied to a file or to another buffer

---
level: 2
---

# In-situ Visualization with ADIOS2

  <div class="w-180">
        <img src="/img/06_adios_plugin.png" class="ml-20 border=1px"/>
  </div>

---
level: 2
---

## Run-time selection for multiple options for Visualization

<br>
  <div class="w-180">
        <img src="/img/06_adios_multiple.png" class="ml-20 border=1px"/>
  </div>

---
level: 2
---

# User-defined visualization programs (pipelines)

<div grid="~ cols-2 gap-4" class="mt-4">
 <div class="col-span-1">
```c
// VTK-m

fides::io::DataSetReader reader("fides.json");
std::unordered_map<std::string, std::string> paths;

paths[source_name] = std::string("gs.bp");
fides::DataSourceParams parms;
parms["engine_type"] = "SST";
reader.SetDataSourceParameters("source",
                               std::move(parms));

vtkm::cont::PartitionedDataSet output = 
    reader.ReadDataSet(paths, sels);
vtkm::Vec3f origin(3.15, 3.15, 3.15), normal(0., 0., 1.);
vtkm::filter::contour::ClipWithImplicitFunction  clip;

clip.SetImplicitFunction(vtkm::Plane(origin, normal));
clip.SetInvertClip(1);
clip.SetFieldsToPass("U");

vtkm::cont::DataSet outputData = clip.Execute(inputData);
```

 </div>

 <div class="col-span-1">

```python
# ParaView Python

mesh = TrivialProducer(registrationName='fides')
clip = Clip(registrationName="clip1", Input=mesh)
clip.ClipType = 'Plane'
clip.ClipType.Origin = [3.15, 3.15, 3.15]
clip.ClipType.Normal = [0.0, 0.0, 1.0]

clipDisplay = Show(clip)
ColorBy(clipDisplay, ('POINTS', 'U'))

camera = GetActiveCamera()
camera.Roll(-45)
camera.Elevation(-45)
```
 </div>
</div>

---
level: 2
---

# Summary
<br>

- Reviewed definitions of `post-hoc`, `in-situ`, and `in-transit` visualization
- Introduced two Conduit-based solutions providing filtering and rendering engines.
    - `ParaView Catalyst`, and
    - `Ascent`,
- Introduced `ADIOS` and `Fides`
- Focused on the ADIOS ParaView engine plugin
- Focused on the ADIOS SST engine to drive, either
    - A Viskores visualization and rendering program, or
    - A Catalyst Python program for ParaView
- The `in-transit` concept needs tuning, to properly balance compute and viz
resources

---
level: 2
---

# Summary

  <div class="w-130">
        <img src="/img/06_summary_1.png" class="ml-1 border=1px"/>
  </div>

---
level: 2
---

# Summary

  <div class="w-160">
        <img src="/img/06_summary_2.png" class="ml-60 border=1px"/>
  </div>

---
level: 2
---

# Summary

  <div class="w-180">
        <img src="/img/06_summary_3.png" class="ml-20 border=1px"/>
  </div>

---
level: 2
---

# Where can I try it?

- `Ascent`, `Catalyst`, `ADIOS` and `Fides` are available on ALPS systems at CSCS.
- Uenvs are being updated `as we speak`

<br>

## In practice

- https://ascent.readthedocs.io/en/latest/ExampleIntegrations.html
- Link to [Gray-Scott Fides] `demo`
- Link to [Adios-Catalyst] `demo`
- Link to our in-situ visualization [tutorial] `examples`


[Gray-Scott Fides]: https://gitlab.kitware.com/vtk/fides/-/tree/master/examples/gray-scott
[Adios-Catalyst]: https://gitlab.kitware.com/paraview/adioscatalyst/-/tree/main/Examples/UnstructuredGrid
[tutorial]: https://github.com/jfavre/InSitu-Vis-Tutorial/tree/main/Examples

---
level: 2
---

# Acknowledgments
<br>

- Jean-Guillaume Piccinali and Alberto Invernizzi for their great efforts deploying and testing the different uenvs

