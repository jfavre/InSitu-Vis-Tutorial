---
layout: section
---

# Instrument an SPH simulation code with Ascent

---
level: 2
---

## Example: Instrument an SPH simulation code with Ascent
<br>

- The smooth particle hydrodynamics (SPH) technique is a purely Lagrangian
method. 
- SPH discretizes a fluid in a series of interpolation points whose
distribution follows the mass density of the fluid.
    - [PASC], the Swiss Platform for Advanced Scientific Computing initiative,
    supports the SPH-EXA project developing an SPH library.
    - [SPH-EXA] is a C++20 headers-only code with no external software
    dependencies. The parallelism is currently expressed via the following
    models: MPI, OpenMP, CUDA and HIP.
        - Add Ascent to SPH-EXA:
            - Define a Conduit **[mesh]** definition
            - Define a Conduit **[scene]** definition
            - About 150 lines of **[code]**. Total!

[PASC]: https://www.pasc-ch.org/
[SPH-EXA]: https://github.com/sphexa-org/sphexa.git
[mesh]: https://github.com/unibas-dmi-hpc/SPH-EXA/blob/develop/main/src/ascent_adaptor.h#L109
[scene]: https://github.com/unibas-dmi-hpc/SPH-EXA/blob/develop/main/src/ascent_adaptor.h#L45
[code]: https://github.com/sphexa-org/sphexa/blob/develop/main/src/ascent_adaptor.h

---
level: 2
---

## Using Conduit, a particle set is trivially described
### \[the coordinates\]

```python
particle_set = """
  coordsets:
  coords:
  type: "explicit"
  values:
    x: [0.0, 10.0, 20.0, 30.0]
    y: [0.0, 10.0, 20.0, 30.0]
    z: [0.0, 10.0, 20.0, 30.0]
 """
```

```c
conduit::Node mesh;

mesh["state/cycle"].set_external(&d.iteration);
mesh["state/time"].set_external(&d.ttot);
mesh["coordsets/coords/type"] = "explicit";

mesh["coordsets/coords/values/x"].set_external(&d.x);
mesh["coordsets/coords/values/y"].set_external(&d.y);
mesh["coordsets/coords/values/z"].set_external(&d.z);
// The heavy-data is available via shallow-copy links
```

---
level: 2
---

## Using Conduit, a particle set is trivially described
### \[the topology\]

```python
particle_set = """
   topologies:
     mesh:
       type: "unstructured"
       elements:
       shape: "point"
       connectivity: [0, 1, 2, 3]
       coordset: "coords"
"""
```

```c
mesh["topologies/mesh/type"].set("unstructured");
mesh["topologies/mesh/elements/shape"].set("point");
mesh["topologies/mesh/coordset"].set("coords");

std::vector<int> conn(N); // N is # of particles
std::iota(conn.begin(), conn.end(), 0);
mesh["topologies/mesh/elements/connectivity"].set_external(conn); // <---
//                                            ------------
```

---
level: 2
---

## Using Conduit, a particle set is trivially described
### \[the solution fields\]

```python
particle_set = """
 fields:
   rho:
    association: "vertex"
    values: [-1, -2, -3, -4]
    topology: "mesh"
    volume_dependent: "false"
    units: "g/cc"
"""
```

```c
auto fields = mesh["fields"];

// Density scalar field:
fields["rho/association"].set("vertex");
fields["rho/topology"].set("mesh");
fields["rho/volume_dependent"].set("false");

// Conduit supports shallow copy
fields["rho/values"].set_external(&d.rho); // <---
//                   ------------
```
