
spack load adios2
spack load py-matplotlib

cmake -B buildSSTConsumer -S . \
 -DCMAKE_BUILD_TYPE=Release \
 -DFides_DIR=/local/apps/fides-adios2.11-install/lib/cmake/fides \
 -DViskores_DIR=/local/apps/viskores-build-tbb/lib/cmake/viskores-1.1

cmake --build buildSSTConsumer
 
# First run. Classic output to an ADIOS BP file
# make sure adios2.xml contains the string <engine type="BP4">
 
mpiexec -n 2 python3 heat_diffusion_insitu_parallel.py 

bpls -la diffusion.bp

# Second run. In transit transfer to a data consumer

# make sure adios2.xml contains the string <engine type="SST">

rm -rf diffusion.bp
. ~/viskores.sh
mpiexec -n 2 python3 heat_diffusion_insitu_parallel.py &

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:`spack location -i adios2`/lib
./buildSSTConsumer/fides-sst-reader
# view images
eog diffusion*png

